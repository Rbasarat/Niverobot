# this should be the same as the dockerfile image.
image: mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim

before_script:
    - cd Niverobot

stages:
    # - build
    #- test
    - deploy
    
variables:
    publishdir: "bin/release/"

build:
    # stage: build
    # script:
    #     - "dotnet restore"
    #     - "dotnet build -c release"
    # artifacts:
    #     paths:
    #         - "Niverobot/Niverobot.WebApi/bin/"
    #     expire_in: 1 week
        
# test:
#     stage: test
#     script: 
#         - "dotnet test"
#         - echo "testing"

deploy: 
    stage: deploy
    variables:
        deploy_path: "src/App/"
    # only:
    #     - master
    # artifacts:
    #     paths:
    #         - Niverobot/Niverobot.WebApi/bin/
    #     expire_in: 1 week
    script:
    # publish the files - this will generate the publish files in bin/release 
    - docker build
    # install zip and lftp
    # - apt-get update -qq && apt-get install -y -qq zip lftp 
    # # upload file to ftp
    # - lftp -e "set ssl:verify-certificate no; lpwd; open $FTP_HOST; user $FTP_USERNAME $FTP_PASSWORD; put -O /files/ CreativelyCode.zip; bye"